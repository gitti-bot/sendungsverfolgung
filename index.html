<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Paket Tracking</title>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js"></script>
    <script src="https://rawgit.com/schmich/instascan-builds/master/instascan.min.js"></script>
</head>
<body>
    <h1>Paket Tracking</h1>
    
    <!-- Video-Element fÃ¼r QR-Code Scanner -->
    <video id="preview" width="100%"></video>
    
    <input type="text" id="sendungsnummer" placeholder="Sendungsnummer manuell eingeben">
    <button onclick="getTrackingDetails()">Sendung abrufen</button>

    <h2>Status: <span id="status"></span></h2>

    <input type="text" id="neuerStatus" placeholder="Neuer Status">
    <button onclick="updateTrackingStatus()">Status aktualisieren</button>

    <script type="module">
         // ðŸ”¥ Firebase importieren
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getFirestore, doc, getDoc, updateDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        // ðŸ”¥ Firebase-Konfiguration (ersetzen mit deinen Werten!)
        const firebaseConfig = {
            apiKey: "AIzaSyDKSAt2r-Ch9KDb_ft5PkiphE7df5TSA-Y",
            authDomain: "sendungsverfolgung-1d5f6.firebaseapp.com",
            projectId: "sendungsverfolgung-1d5f6",
            storageBucket: "sendungsverfolgung-1d5f6.firebasestorage.app",
            messagingSenderId: "600596742161",
            appId: "600596742161"
        //measurementId: "G-PK7T5T6GCD"
        };

        // ðŸ”¥ Firebase initialisieren
             //firebase.initializeApp(firebaseConfig);
            //const db = firebase.firestore();
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);    

        // ðŸ“Œ QR-Code Scanner aktivieren
        let scanner = new Instascan.Scanner({ video: document.getElementById('preview') });
        scanner.addListener('scan', function (code) {
            document.getElementById('sendungsnummer').value = code;
            getTrackingDetails();
        });

        Instascan.Camera.getCameras().then(function (cameras) {
            if (cameras.length > 0) {
                scanner.start(cameras[0]);
            } else {
                alert('Keine Kamera gefunden');
            }
        });

        // ðŸ“Œ Sendung aus Firestore abrufen
        async function getTrackingDetails() {
        let sendungsnummer = document.getElementById('sendungsnummer').value;
        if (!sendungsnummer) {
            alert("Bitte eine Sendungsnummer eingeben oder scannen!");
            return;
        }

        const docRef = doc(db, "pakete", sendungsnummer);
        const docSnap = await getDoc(docRef);

        if (docSnap.exists()) {
            document.getElementById("status").innerText = docSnap.data().status;
        } else {
            alert("Sendung nicht gefunden!");
        }
    }

        // ðŸ“Œ Sendungsstatus aktualisieren
        async function updateTrackingStatus() {
        let sendungsnummer = document.getElementById('sendungsnummer').value;
        let neuerStatus = document.getElementById('neuerStatus').value;
        if (!sendungsnummer || !neuerStatus) {
            alert("Bitte eine Sendungsnummer und den neuen Status eingeben!");
            return;
        }

        const docRef = doc(db, "pakete", sendungsnummer);
        await updateDoc(docRef, {
            status: neuerStatus,
            timestamp: new Date()
        });

        alert("Status erfolgreich aktualisiert!");
        getTrackingDetails();
    }

    // ðŸ“Œ Globale Funktionen fÃ¼r Button-Klicks
    window.getTrackingDetails = getTrackingDetails;
    window.updateTrackingStatus = updateTrackingStatus;
    </script>
</body>
</html>
            
