<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tracking-System</title>
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js"></script>

    <!-- QR-Code Scanner -->
    <script src="https://rawgit.com/schmich/instascan-builds/master/instascan.min.js"></script>
</head>
<body>

    <h1>Tracking-System</h1>

    <video id="preview" width="300" height="200"></video>
    <input type="text" id="sendungsnummer" placeholder="Sendungsnummer">
    <button onclick="getTrackingDetails()">Status abrufen</button>
    <button onclick="updateTrackingStatus()">Status aktualisieren</button>

    <script>
        // Firebase-Konfiguration (ersetze mit deinen Daten)
        const firebaseConfig = {
            apiKey: "AIzaSyDKSAt2r-Ch9KDb_ft5PkiphE7df5TSA-Y",
            authDomain: "sendungsverfolgung-1d5f6.firebaseapp.com",
            projectId: "sendungsverfolgung-1d5f6",
            storageBucket: "sendungsverfolgung-1d5f6.firebasestorage.app",
            messagingSenderId: "600596742161",
            appId: "1:600596742161:web:ebf4db22b3fbe2636371b0"
            //measurementId: "G-PK7T5T6GCD"
        };

        // Firebase initialisieren
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();

        // QR-Code Scanner aktivieren
        let scanner = new Instascan.Scanner({ video: document.getElementById('preview') });
        scanner.addListener('scan', function (code) {
            document.getElementById('sendungsnummer').value = code;
            getTrackingDetails();
        });

        Instascan.Camera.getCameras().then(function (cameras) {
            if (cameras.length > 0) {
                scanner.start(cameras[0]);
            } else {
                alert('Keine Kamera gefunden');
            }
        });

        // Funktion zum Abrufen der Tracking-Daten
        function getTrackingDetails() {
            let sendungsnummer = document.getElementById('sendungsnummer').value;
            if (!sendungsnummer) return;

            db.collection("sendungen").doc(sendungsnummer).get().then((doc) => {
                if (doc.exists) {
                    let data = doc.data();
                    alert("Status: " + data.status + "\nStandort: " + data.standort);
                } else {
                    alert("Sendung nicht gefunden!");
                }
            }).catch((error) => {
                console.error("Fehler beim Abrufen:", error);
            });
        }

        // Funktion zum Aktualisieren des Status
        function updateTrackingStatus() {
            let sendungsnummer = document.getElementById('sendungsnummer').value;
            let neuerStatus = prompt("Neuen Status eingeben:");
            let neuerStandort = prompt("Neuen Standort eingeben:");

            if (!sendungsnummer || !neuerStatus || !neuerStandort) return;

            db.collection("sendungen").doc(sendungsnummer).update({
                status: neuerStatus,
                standort: neuerStandort,
                letzte_aktualisierung: firebase.firestore.FieldValue.serverTimestamp()
            }).then(() => {
                alert("Status erfolgreich aktualisiert!");
            }).catch((error) => {
                console.error("Fehler beim Update:", error);
            });
        }
    </script>
</body>
</html>
